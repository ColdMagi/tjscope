"use strict";(self.webpackChunktjscope=self.webpackChunktjscope||[]).push([[482],{4482:function(e,n,s){s.r(n),s.d(n,{default:function(){return I}});var r=s(3433),t=s(1413),i=s(9439),l=s(7762),c=s(9712),a=s(5443),o=s(7552),d=s(1089),u=s(2157),x=s(4827),h=s(184);var j=function(e){var n=e.value;return(0,h.jsx)(h.Fragment,{children:n?"\u0414\u0430":"\u041d\u0435\u0442"})},m=s(8977);var f=function(e){var n=e.comment,s=n.author,r=s.avatar_url,t=s.name,i=n.date,l=n.likes,a=l.count,o=l.summ,d=n.id,x=n.entry.url,j=n.html;return(0,h.jsxs)(c.gC,{align:"flex-start",as:"a",href:x+"?comment=".concat(d),rel:"nofollow noopener noreferrer",target:"_blank",p:"3",shadow:"md",borderWidth:"1px",rounded:"md",minW:"100%",spacing:3,children:[(0,h.jsxs)(c.Ug,{justifyContent:"space-between",minW:"100%",children:[(0,h.jsxs)(c.Ug,{children:[(0,h.jsx)(u.qE,{size:"xs",src:r,name:t}),(0,h.jsx)(c.X6,{size:"sm",children:t})]}),(0,h.jsx)(c.xv,{color:"gray.400",as:"time",children:(0,m.Z)(1e3*i,"dd.LL.yy")})]}),(0,h.jsx)(c.gC,{pl:"8",children:(0,h.jsx)(c.xv,{dangerouslySetInnerHTML:{__html:j}})}),(0,h.jsxs)(c.Ug,{justifyContent:"space-between",minW:"100%",children:[(0,h.jsx)("span",{}),(0,h.jsxs)(c.Ug,{children:[(0,h.jsx)(c.xv,{color:"red.300",children:a-o}),(0,h.jsx)(c.xv,{color:"green.300",children:o})]})]})]})},v=s(4828);var g=function(e){var n=e.entry,s=n.url,r=n.hitsCount,t=n.intro,i=n.date,l=n.likes,a=l.count,o=l.summ,d=n.cover,x=n.subsite,j=x.avatar_url,f=x.name;return(0,h.jsxs)(c.gC,{align:"flex-start",as:"a",href:s,rel:"nofollow noopener noreferrer",target:"_blank",p:"3",shadow:"md",borderWidth:"1px",rounded:"md",minW:"100%",spacing:3,children:[(0,h.jsxs)(c.Ug,{justifyContent:"space-between",minW:"100%",children:[(0,h.jsxs)(c.Ug,{children:[(0,h.jsx)(u.qE,{size:"xs",src:j,name:f}),(0,h.jsx)(c.X6,{size:"sm",children:f})]}),(0,h.jsx)(c.xv,{color:"gray.400",as:"time",children:(0,m.Z)(1e3*i,"dd.LL.yy")})]}),(0,h.jsxs)(c.gC,{pl:"8",children:[(0,h.jsx)(c.xv,{children:t}),d&&(0,h.jsx)(v.Ee,{src:d.thumbnailUrl,alt:"",objectFit:"contain",pointerEvents:"none"})]}),(0,h.jsxs)(c.Ug,{justifyContent:"space-between",minW:"100%",children:[(0,h.jsxs)(c.xv,{pl:"8",color:"gray.400",children:[r," \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u043e\u0432"]}),(0,h.jsxs)(c.Ug,{children:[(0,h.jsx)(c.xv,{color:"red.300",children:a-o}),(0,h.jsx)(c.xv,{color:"green.300",children:o})]})]})]})};var p=function(e){var n=e.label,s=void 0===n?"\u0420\u0435\u0439\u0442\u0438\u043d\u0433":n,r=e.children;return(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:s}),(0,h.jsx)(a.Jf,{color:"gray.500",children:r})]})},k=s(4165),b=s(5861),y=s(2791),w="https://api.tjournal.ru/v2.31",C=(0,y.createContext)(w),Z=function(){return(0,y.useContext)(C)};function L(e,n){var s=(0,y.useRef)({}),r=(0,y.useRef)(!1),l={error:void 0,data:void 0},c=(0,y.useReducer)((function(e,n){switch(n.type){case"loading":return(0,t.Z)({},l);case"fetched":return(0,t.Z)((0,t.Z)({},l),{},{data:n.payload});case"error":return(0,t.Z)((0,t.Z)({},l),{},{error:n.payload});default:return e}}),l),a=(0,i.Z)(c,2),o=a[0],d=a[1];return(0,y.useEffect)((function(){if(e){r.current=!1;var t=function(){var t=(0,b.Z)((0,k.Z)().mark((function t(){var i,l;return(0,k.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d({type:"loading"}),!s.current[e]){t.next=4;break}return d({type:"fetched",payload:s.current[e]}),t.abrupt("return");case 4:return t.prev=4,t.next=7,fetch(e,n);case 7:if((i=t.sent).ok){t.next=10;break}throw new Error(i.statusText);case 10:return t.next=12,i.json();case 12:if(l=t.sent,s.current[e]=l,!r.current){t.next=16;break}return t.abrupt("return");case 16:d({type:"fetched",payload:l}),t.next=24;break;case 19:if(t.prev=19,t.t0=t.catch(4),!r.current){t.next=23;break}return t.abrupt("return");case 23:d({type:"error",payload:t.t0});case 24:case"end":return t.stop()}}),t,null,[[4,19]])})));return function(){return t.apply(this,arguments)}}();return t(),function(){r.current=!0}}}),[e]),o}function N(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2.31",r=Z();return L(e?"".concat(r.replace("2.31",s)).concat(e):e,n)}function T(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2.31",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,c=(0,y.useState)({result:[]}),a=(0,i.Z)(c,2),o=a[0],d=a[1],u=(0,y.useState)(0),x=(0,i.Z)(u,2),h=x[0],j=x[1],m=N(e+"?count=".concat(l,"&offset=").concat(h),n,s),f=m.data;return(0,y.useEffect)((function(){if(f&&(d((function(e){return(0,t.Z)((0,t.Z)((0,t.Z)({},e),f),{},{result:[].concat((0,r.Z)(e.result),(0,r.Z)(f.result))})})),f.result.length>=l)){var e=setTimeout((function(){return j((function(e){return e+l}))}),2e3);return function(){return clearTimeout(e)}}}),[f,l]),o}var W=s(3504),D=s(3859);function J(e){var n=e.subsite;return(0,h.jsxs)(c.gC,{divider:(0,h.jsx)(c.cX,{}),children:[(0,h.jsxs)(c.MI,{columns:4,spacing:3,children:[(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041f\u043e\u0441\u0442\u043e\u0432"}),(0,h.jsx)(a.Jf,{children:n.counters.entries})]}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432"}),(0,h.jsx)(a.Jf,{children:n.counters.comments})]}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041f\u043e\u0434\u043f\u0438\u0441\u043e\u043a"}),(0,h.jsx)(a.Jf,{children:n.counters.subscriptions})]}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041f\u043e\u0434\u043f\u0438\u0441\u0447\u0438\u043a\u043e\u0432"}),(0,h.jsx)(a.Jf,{children:n.counters.subscribers})]})]}),(0,h.jsxs)(c.MI,{columns:2,spacing:3,justifyContent:"space-between",minW:"100%",children:[(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"Plus"}),(0,h.jsx)(a.Jf,{children:(0,h.jsx)(j,{value:n.isPlus})})]}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d"}),(0,h.jsx)(a.Jf,{children:(0,h.jsx)(j,{value:n.isVerified})})]})]})]})}function U(e){var n=e.label,s=e.children;return(0,h.jsxs)(c.gC,{align:"flex-start",minW:"100%",children:[(0,h.jsx)(c.X6,{size:"md",children:n}),s]})}function _(e){var n=e.data,s=(0,y.useMemo)((function(){var e,s={rating:0,ratingCount:0,comments:0,reposts:0,hits:0,mostHits:((null===n||void 0===n?void 0:n.result)||[])[0],mostLiked:((null===n||void 0===n?void 0:n.result)||[])[0],mostDisliked:((null===n||void 0===n?void 0:n.result)||[])[0]},r=(0,l.Z)((null===n||void 0===n?void 0:n.result)||[]);try{for(r.s();!(e=r.n()).done;){var t=e.value;s.rating+=t.likes.summ,s.ratingCount+=t.likes.count,s.comments+=t.commentsCount,s.reposts+=Number(t.isRepost),s.hits+=t.hitsCount,t.hitsCount>s.mostHits.hitsCount&&(s.mostHits=t),t.likes.summ>s.mostLiked.likes.summ&&(s.mostLiked=t),t.likes.count-t.likes.summ>s.mostDisliked.likes.count-s.mostDisliked.likes.summ&&(s.mostDisliked=t)}}catch(i){r.e(i)}finally{r.f()}return s}),[n]);return(0,h.jsxs)(c.gC,{align:"flex-start",w:"100%",pl:"2",spacing:4,children:[(0,h.jsxs)(c.MI,{columns:3,spacing:1,justifyContent:"space-between",minW:"100%",children:[(0,h.jsx)(p,{children:s.rating}),(0,h.jsx)(p,{label:"\u041e\u0446\u0435\u043d\u043e\u043a",children:s.ratingCount}),(0,h.jsx)(p,{label:"\u041e\u0446\u0435\u043d\u043a\u0438 [\u043c\u0438\u043d\u0443\u0441]",children:s.ratingCount-s.rating}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432"}),(0,h.jsx)(a.Jf,{children:s.comments})]}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u043e\u0432"}),(0,h.jsx)(a.Jf,{children:s.hits})]}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u0420\u0435\u043f\u043e\u0441\u0442\u043e\u0432"}),(0,h.jsx)(a.Jf,{children:s.reposts})]})]}),s.mostHits&&(0,h.jsx)(U,{label:"\u041d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u043e\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0435\u043c\u044b\u0439",children:(0,h.jsx)(g,{entry:s.mostHits})}),s.mostLiked&&(0,h.jsx)(U,{label:"\u041d\u0430\u0438\u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043b\u044e\u0441\u043e\u0432",children:(0,h.jsx)(g,{entry:s.mostLiked})}),s.mostDisliked&&(0,h.jsx)(U,{label:"\u041d\u0430\u0438\u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0438\u043d\u0443\u0441\u043e\u0432",children:(0,h.jsx)(g,{entry:s.mostDisliked})})]})}function E(e){var n=e.data,s=(0,y.useMemo)((function(){var e,s={rating:0,ratingCount:0,mostLiked:((null===n||void 0===n?void 0:n.result)||[])[0],mostDisliked:((null===n||void 0===n?void 0:n.result)||[])[0]},r=(0,l.Z)((null===n||void 0===n?void 0:n.result)||[]);try{for(r.s();!(e=r.n()).done;){var t=e.value;s.rating+=t.likes.summ,s.ratingCount+=t.likes.count,t.likes.summ>s.mostLiked.likes.summ&&(s.mostLiked=t),t.likes.count-t.likes.summ>s.mostDisliked.likes.count-s.mostDisliked.likes.summ&&(s.mostDisliked=t)}}catch(i){r.e(i)}finally{r.f()}return s}),[n]);return(0,h.jsxs)(c.gC,{align:"flex-start",w:"100%",pl:"2",spacing:4,children:[(0,h.jsxs)(c.MI,{columns:3,spacing:1,justifyContent:"space-between",minW:"100%",children:[(0,h.jsx)(p,{children:s.rating}),(0,h.jsx)(p,{label:"\u041e\u0446\u0435\u043d\u043e\u043a",children:s.ratingCount}),(0,h.jsx)(p,{label:"\u041e\u0446\u0435\u043d\u043a\u0438 [\u043c\u0438\u043d\u0443\u0441]",children:s.ratingCount-s.rating})]}),s.mostLiked&&(0,h.jsx)(U,{label:"\u041d\u0430\u0438\u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043b\u044e\u0441\u043e\u0432",children:(0,h.jsx)(f,{comment:s.mostLiked})}),s.mostDisliked&&(0,h.jsx)(U,{label:"\u041d\u0430\u0438\u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0438\u043d\u0443\u0441\u043e\u0432",children:(0,h.jsx)(f,{comment:s.mostDisliked})})]})}function z(e){var n,s,l=e.comments,a=(0,y.useState)({}),x=(0,i.Z)(a,2),j=x[0],m=x[1],f=(0,y.useState)(0),v=(0,i.Z)(f,2),g=v[0],p=v[1],k=N("/comment/likers/".concat(null===(n=((null===l||void 0===l?void 0:l.result)||[])[g])||void 0===n?void 0:n.id),void 0,"1.9").data;return(0,y.useEffect)((function(){if(k){m((function(e){for(var n=(0,t.Z)({},e),s=0,r=Object.entries(k.result);s<r.length;s++){var l=(0,i.Z)(r[s],2),c=l[0],a=l[1];Reflect.has(n,c)||(n[c]={total:0,minus:0,plus:0,avatar_url:"",name:""}),n[c].total+=Math.abs(a.sign),n[c].minus+=Number(a.sign<0),n[c].plus+=Number(a.sign>0),n[c].avatar_url=a.avatar_url,n[c].name=a.name}return n}));var e=setTimeout((function(){return p((function(e){return e+1}))}),2e3);return function(){return clearTimeout(e)}}}),[k]),(0,h.jsxs)(c.gC,{position:"relative",children:[(null===l||void 0===l||null===(s=l.result)||void 0===s?void 0:s.length)>g&&(0,h.jsx)(o.Ex,{size:"xs",isIndeterminate:!0,w:"100%"}),(0,h.jsx)(d.xJ,{children:(0,h.jsxs)(d.iA,{variant:"simple",children:[(0,h.jsx)(d.Rn,{children:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043e\u0446\u0435\u043d\u043e\u043a \u043f\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c"}),(0,h.jsx)(d.hr,{children:(0,h.jsxs)(d.Tr,{children:[(0,h.jsx)(d.Th,{children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c"}),(0,h.jsx)(d.Th,{isNumeric:!0,children:"\u041f\u043b\u044e\u0441"}),(0,h.jsx)(d.Th,{isNumeric:!0,children:"\u041c\u0438\u043d\u0443\u0441"}),(0,h.jsx)(d.Th,{isNumeric:!0,children:"\u0412\u0441\u0435\u0433\u043e"})]})}),(0,h.jsx)(d.p3,{children:(0,r.Z)(Object.entries(j)).map((function(e){var n=(0,i.Z)(e,2),s=n[0],r=n[1],t=r.name,l=r.avatar_url,a=r.minus,o=r.plus,x=r.total;return(0,h.jsxs)(d.Tr,{children:[(0,h.jsx)(d.Td,{children:(0,h.jsxs)(c.Ug,{as:"a",href:"https://tjournal.ru/u/".concat(s),target:"_blank",children:[(0,h.jsx)(u.qE,{name:t,src:l}),(0,h.jsx)(c.xv,{as:"b",maxW:"200px",textOverflow:"ellipsis",overflow:"hidden",children:t})]})}),(0,h.jsx)(d.Td,{children:x}),(0,h.jsx)(d.Td,{children:a}),(0,h.jsx)(d.Td,{children:o})]},s)}))})]})})]})}function M(e){var n=e.subsite;return(0,h.jsxs)(c.Ug,{spacing:10,position:"sticky",top:"0",bg:"white",zIndex:"1000",pt:"5",pb:"2",px:"4",children:[(0,h.jsx)(u.qE,{name:n.name,size:"2xl",src:"https://leonardo.osnova.io/".concat(n.avatar.data.uuid,"/-/scale_crop/300x300/-/format/webp/")}),(0,h.jsxs)(c.gC,{children:[(0,h.jsx)(c.X6,{size:"lg",children:n.name}),(0,h.jsxs)(c.Ug,{justifyContent:"space-between",minW:"100%",children:[(0,h.jsx)(p,{children:n.rating}),(0,h.jsxs)(a.kN,{children:[(0,h.jsx)(a.dw,{children:"\u0421\u043e\u0437\u0434\u0430\u043d"}),(0,h.jsx)(a.Jf,{children:(0,m.Z)(1e3*n.created,"dd.LL.yy")})]})]})]})]})}var I=function(){var e=(0,W.lr)(),n=(0,i.Z)(e,1)[0],s=(0,D.s)(n.get("id")||""),r=N("/subsite?id=".concat(s)).data,t=T("/user/".concat(s,"/entries"),void 0,"1.9"),l=T("/user/".concat(s,"/comments"),void 0,"1.9");if(!r||!r.result)return null;var a=r.result.subsite;return(0,h.jsxs)(c.gC,{align:"start",children:[(0,h.jsx)(M,{subsite:a}),(0,h.jsxs)(x.mQ,{variant:"enclosed",children:[(0,h.jsxs)(x.td,{children:[(0,h.jsx)(x.OK,{children:"\u041e\u0431\u0437\u043e\u0440"}),(0,h.jsx)(x.OK,{children:"\u041f\u043e\u0441\u0442\u044b"}),(0,h.jsx)(x.OK,{children:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438"}),(0,h.jsx)(x.OK,{children:"\u0418\u0442\u043e\u0433"})]}),(0,h.jsxs)(x.nP,{children:[(0,h.jsx)(x.x4,{children:(0,h.jsx)(J,{subsite:a})}),(0,h.jsx)(x.x4,{children:(0,h.jsx)(c.gC,{align:"flex-start",divider:(0,h.jsx)(c.cX,{}),w:"100%",maxW:"438px",children:(0,h.jsx)(_,{data:t})})}),(0,h.jsx)(x.x4,{children:(0,h.jsx)(c.gC,{align:"flex-start",divider:(0,h.jsx)(c.cX,{}),w:"100%",maxW:"438px",children:(0,h.jsx)(E,{data:l})})}),(0,h.jsx)(x.x4,{children:(0,h.jsx)(z,{comments:l})})]})]})]})}},3859:function(e,n,s){s.d(n,{s:function(){return r}});var r=function(e){return+(/(?:u\/)?(\d+)/.exec(e||"")||[])[1]||0}}}]);
//# sourceMappingURL=482.0cc3e0ec.chunk.js.map